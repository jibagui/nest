<!-- ===== [1/5] ===== -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>실시간 합성파 생성기</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    #controls, #sample-controls { background: #fff; padding: 20px; border-bottom: 1px solid #ddd; }
    #osc-list, #sample-osc-list { margin-bottom: 10px; }
    .osc-row, .sample-osc-row { margin-bottom: 8px; }
    .osc-row input[type="number"], .sample-osc-row input[type="number"] { width: 70px; }
    .osc-row input[type="range"], .sample-osc-row input[type="range"] {
      width: 120px; margin: 0 8px; vertical-align: middle;
      will-change: transform;
      height: 18px;
      border-radius: 9px;
      background: #e3e3e3;
      accent-color: #2196f3;
    }
    .osc-row label, .sample-osc-row label { margin-right: 5px; }
    .osc-row button, .sample-osc-row button { margin-left: 10px; }
    .osc-btn, .sample-osc-btn {
      display: inline-block;
      min-width: 60px; min-height: 36px;
      padding: 0 16px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      margin-left: 10px;
      vertical-align: middle;
      cursor: pointer;
      transition: background 0.15s;
    }
    .on { background: #4caf50; color: #fff; }
    .off { background: #eee; color: #444; }
    .del { background: #e53935; color: #fff; }
    #play-btn, #restart-btn, #sample-play-btn, #back-btn, .osc-util-btn {
      font-size: 1.2em; padding: 0.7em 2em; border: none; border-radius: 8px;
      background: #2196f3; color: #fff; margin-bottom: 1em; cursor: pointer;
      margin-right: 1em;
    }
    #restart-btn { background: #ffa726; color: #fff; margin-left: 0; }
    .osc-util-btn { background: #eee; color: #222; font-size: 1em; margin-right: 0.7em; }
    .osc-util-btn.active { background: #ff9800; color: #fff; }
    .osc-util-btn:disabled,
    .osc-util-btn.disabled {
      background: #bbb !important;
      color: #fff !important;
      cursor: not-allowed !important;
      opacity: 1 !important;
    }
    .formula {
      font-size: 1em;
      margin-left: 1.5em;
      color: #333;
      font-family: 'Consolas', 'Menlo', 'Monaco', monospace;
      background: #f6f6f6;
      border-radius: 6px;
      padding: 2px 8px;
      display: inline-block;
    }
    #canvas-wrap, #sample-canvas-wrap {
      text-align: center;
      margin: 0 auto;
      background: #fff;
      width: 100%;
      max-width: 900px;
      box-sizing: border-box;
      position: relative;
    }
    canvas {
      border: 1px solid #bbb;
      background: #fafafa;
      margin: 20px auto;
      display: block;
      touch-action: none;
    }
    #sample-buttons {
      display: flex; gap: 20px; justify-content: center; margin: 36px 0 24px 0;
    }
    .wave-btn {
      border: 2px solid #aaa; border-radius: 12px; background: #fff; cursor: pointer;
      width: 120px; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center;
      box-shadow: 0 2px 8px #0001; transition: box-shadow .2s;
    }
    .wave-btn:hover { box-shadow: 0 4px 16px #0002; border-color: #2196f3; }
    .wave-btn svg { width: 80px; height: 40px; margin-bottom: 8px; }
    .wave-btn span { font-size: 1.1em; margin-top: 2px; }
    .wave-btn svg polyline { stroke-width: 4 !important; }
    #sample-controls, #sample-canvas-wrap {
      visibility: hidden; position: absolute; left: -9999px;
    }
    #controls, #canvas-wrap, #sample-buttons {
      visibility: visible; position: static;
    }
    .show-sample #sample-controls, .show-sample #sample-canvas-wrap {
      visibility: visible !important; position: static !important;
    }
    .show-sample #controls, .show-sample #canvas-wrap, #sample-buttons {
      visibility: hidden !important; position: absolute !important; left: -9999px !important;
    }
    #sample-osc-list { margin-top: 8px; }
    #back-btn { background: #888; color: #fff; margin-left: 0; }
    .sample-formula-math {
      background: #f6f6f6;
      border-radius: 8px;
      padding: 18px 18px 12px 18px;
      margin: 16px auto 10px auto;
      font-size: 1.15em;
      max-width: 98vw;
      box-sizing: border-box;
      overflow-x: auto;
      white-space: nowrap;
      text-align: left;
    }
    .sample-formula-math h3 {
      margin: 0 0 8px 0;
      font-size: 1.12em;
      font-weight: bold;
      color: #333;
    }
    .mjx-container[jax="CHTML"] {
      overflow-x: auto !important;
      max-width: 100% !important;
      box-sizing: border-box;
    }
    input[type="range"] { touch-action: none; }
    #osc-modal {
      display: none; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
      background: #0006; z-index: 1000; align-items: center; justify-content: center;
    }
    #osc-modal > div {
      background: #fff; padding: 24px 32px; border-radius: 16px; min-width: 260px;
      box-shadow: 0 4px 24px #0003;
    }
    #osc-modal input[type="number"] { width: 80px; margin-left: 8px; }
    #osc-modal label { display: block; margin: 8px 0 0 0; }
    #osc-modal button { margin-left: 10px; margin-top: 10px; }
  </style>
  <script>
    window.MathJax = {
      tex: { displayMath: [['$$','$$'], ['\\[','\\]']] },
      options: { renderActions: { addMenu: [] } },
      chtml: {
        displayAlign: 'center',
        displayIndent: '0',
        scale: 1,
        linebreaks: { automatic: false }
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>
  <div id="controls">
    <button id="play-btn">▶ 재생</button>
    <button id="restart-btn" title="처음부터 재생">⟲</button>
    <div id="osc-list"></div>
    <div id="osc-btns">
      <button id="add-btn" class="osc-util-btn">함수 추가</button>
      <button id="rand-btn" class="osc-util-btn">무작위 함수</button>
      <button id="nc-btn" class="osc-util-btn">노이즈 캔슬링 OFF</button>
      <button id="reset-btn" class="osc-util-btn">초기화</button>
    </div>
  </div>
  <div id="canvas-wrap">
    <canvas id="waveform" width="820" height="340"></canvas>
  </div>
  <div id="sample-buttons">
    <button class="wave-btn" id="btn-tri">
      <svg viewBox="0 0 80 40">
        <polyline points="0,20 20,0 40,20 60,40 80,20" fill="none" stroke="#2196f3"/>
      </svg>
      <span>Triangle</span>
    </button>
    <button class="wave-btn" id="btn-square">
      <svg viewBox="0 0 80 40">
        <polyline points="0,40 0,0 40,0 40,40 80,40 80,0" fill="none" stroke="#e91e63"/>
      </svg>
      <span>Square</span>
    </button>
    <button class="wave-btn" id="btn-saw">
      <svg viewBox="0 0 80 40">
        <polyline points="0,40 80,0 80,40" fill="none" stroke="#4caf50"/>
      </svg>
      <span>Sawtooth</span>
    </button>
  </div>
  <div id="sample-controls">
    <button id="sample-play-btn">▶ 재생</button>
    <button id="back-btn">← 뒤로가기</button>
    <div id="sample-formula" class="sample-formula-math"></div>
    <div id="sample-osc-list"></div>
    <div id="sample-osc-btns">
      <button id="sample-add-btn" class="osc-util-btn">함수 추가</button>
      <button id="sample-rand-btn" class="osc-util-btn">무작위 함수</button>
      <button id="sample-nc-btn" class="osc-util-btn">노이즈 캔슬링 OFF</button>
      <button id="sample-reset-btn" class="osc-util-btn">초기화</button>
    </div>
  </div>
  <div id="sample-canvas-wrap">
    <canvas id="sample-waveform" width="820" height="340"></canvas>
  </div>
  <div id="osc-modal">
    <div>
      <h3>함수 추가</h3>
      <label>주파수(Hz): <input id="osc-modal-freq" type="number" value="440" min="20" max="2000"></label>
      <label>볼륨(A): <input id="osc-modal-vol" type="number" value="0.5" min="0" max="1" step="0.01"></label>
      <label>위상(°): <input id="osc-modal-phase" type="number" value="0" min="0" max="360"></label>
      <div style="margin-top:16px;text-align:right;">
        <button id="osc-modal-cancel">취소</button>
        <button id="osc-modal-ok">추가</button>
      </div>
    </div>
  </div>
<!-- ===== [1/5 끝] ===== -->
<!-- ===== [2/5] ===== -->
  <script>
    // ===== [전역 변수 및 유틸리티] =====
    let ctx, sampleCtx;
    let isSampleMode = false;
    let oscillators = [];
    let sampleOscillators = [];
    let noiseCancel = false;
    let sampleNoiseCancel = false;
    let playing = false;
    let samplePlaying = false;
    let audioCtx = null;
    let sampleAudioCtx = null;
    let sourceNode = null;
    let sampleSourceNode = null;
    let t0 = 0;
    let sampleT0 = 0;
    const WAVE_TYPES = [
      { name: "sine", label: "사인" },
      { name: "triangle", label: "삼각" },
      { name: "square", label: "사각" },
      { name: "sawtooth", label: "톱니" }
    ];

    // ===== [캔버스 초기화] =====
    function resizeCanvas() {
      const dpr = window.devicePixelRatio || 1;
      const wrap = document.getElementById('canvas-wrap');
      const width = Math.min(wrap.offsetWidth, 900);
      const height = 340;
      const cvs = document.getElementById('waveform');
      cvs.width = width * dpr;
      cvs.height = height * dpr;
      cvs.style.width = width + 'px';
      cvs.style.height = height + 'px';
      ctx = cvs.getContext('2d');
      ctx.setTransform(1, 0, 0, 1, 0, 0);

      const sampleWrap = document.getElementById('sample-canvas-wrap');
      const sampleWidth = Math.min(sampleWrap.offsetWidth, 900);
      const sampleCvs = document.getElementById('sample-waveform');
      sampleCvs.width = sampleWidth * dpr;
      sampleCvs.height = height * dpr;
      sampleCvs.style.width = sampleWidth + 'px';
      sampleCvs.style.height = height + 'px';
      sampleCtx = sampleCvs.getContext('2d');
      sampleCtx.setTransform(1, 0, 0, 1, 0, 0);
    }
    window.addEventListener('resize', resizeCanvas);

    // ===== [오실레이터 데이터 구조 및 기본값] =====
    function defaultOscillator() {
      return {
        type: "sine",
        freq: 440,
        amp: 0.5,
        phase: 0
      };
    }

    // ===== [함수 추가 모달 제어] =====
    function openOscModal(onOk, osc) {
      document.getElementById('osc-modal').style.display = 'flex';
      document.getElementById('osc-modal-freq').value = osc ? osc.freq : 440;
      document.getElementById('osc-modal-vol').value = osc ? osc.amp : 0.5;
      document.getElementById('osc-modal-phase').value = osc ? osc.phase : 0;
      let okHandler = function() {
        const freq = parseFloat(document.getElementById('osc-modal-freq').value);
        const amp = parseFloat(document.getElementById('osc-modal-vol').value);
        const phase = parseFloat(document.getElementById('osc-modal-phase').value);
        document.getElementById('osc-modal').style.display = 'none';
        onOk({ type: "sine", freq, amp, phase });
        document.getElementById('osc-modal-ok').removeEventListener('click', okHandler);
      };
      document.getElementById('osc-modal-ok').addEventListener('click', okHandler);
      document.getElementById('osc-modal-cancel').onclick = function() {
        document.getElementById('osc-modal').style.display = 'none';
        document.getElementById('osc-modal-ok').removeEventListener('click', okHandler);
      };
    }

    // ===== [함수 추가/무작위 함수/초기화/노이즈캔슬 버튼 이벤트] =====
    document.getElementById('add-btn').onclick = function() {
      openOscModal(function(osc) {
        oscillators.push(osc);
        renderOscList();
        drawWave();
      });
    };
    document.getElementById('rand-btn').onclick = function() {
      const type = WAVE_TYPES[Math.floor(Math.random() * WAVE_TYPES.length)].name;
      const freq = Math.floor(Math.random() * 900) + 100;
      const amp = +(Math.random() * 0.8 + 0.2).toFixed(2);
      const phase = Math.floor(Math.random() * 360);
      oscillators.push({ type, freq, amp, phase });
      renderOscList();
      drawWave();
    };
    document.getElementById('reset-btn').onclick = function() {
      oscillators = [];
      renderOscList();
      drawWave();
    };
    document.getElementById('nc-btn').onclick = function() {
      noiseCancel = !noiseCancel;
      this.textContent = noiseCancel ? "노이즈 캔슬링 ON" : "노이즈 캔슬링 OFF";
      drawWave();
    };

    // ===== [2/5 끝] =====
<!-- ===== [3/5] ===== -->
    // ===== [오실레이터 리스트 렌더링 및 슬라이더/입력 최적화] =====
    function renderOscList() {
      const list = document.getElementById('osc-list');
      list.innerHTML = '';
      oscillators.forEach((osc, idx) => {
        const row = document.createElement('div');
        row.className = 'osc-row';

        // 파형 종류 선택
        const typeSel = document.createElement('select');
        WAVE_TYPES.forEach(t => {
          const opt = document.createElement('option');
          opt.value = t.name;
          opt.textContent = t.label;
          if (osc.type === t.name) opt.selected = true;
          typeSel.appendChild(opt);
        });
        typeSel.onchange = function() {
          oscillators[idx].type = this.value;
          drawWave();
        };
        row.appendChild(typeSel);

        // 주파수 슬라이더 + 입력
        row.appendChild(makeSliderInput(osc, idx, 'freq', 20, 2000, 1, 'Hz'));
        // 진폭 슬라이더 + 입력
        row.appendChild(makeSliderInput(osc, idx, 'amp', 0, 1, 0.01, 'A'));
        // 위상 슬라이더 + 입력
        row.appendChild(makeSliderInput(osc, idx, 'phase', 0, 360, 1, '°'));

        // 삭제 버튼
        const delBtn = document.createElement('button');
        delBtn.className = 'osc-btn del';
        delBtn.textContent = '삭제';
        delBtn.onclick = function() {
          oscillators.splice(idx, 1);
          renderOscList();
          drawWave();
        };
        row.appendChild(delBtn);

        list.appendChild(row);
      });
    }

    // ===== [슬라이더+입력 동기화 및 부드러운 입력 최적화] =====
    function makeSliderInput(osc, idx, key, min, max, step, unit) {
      const label = document.createElement('label');
      label.textContent = key === 'freq' ? "주파수" : key === 'amp' ? "볼륨" : "위상";

      const slider = document.createElement('input');
      slider.type = 'range';
      slider.min = min;
      slider.max = max;
      slider.step = step;
      slider.value = osc[key];

      const number = document.createElement('input');
      number.type = 'number';
      number.min = min;
      number.max = max;
      number.step = step;
      number.value = osc[key];

      let rafId = null;
      function update(val) {
        osc[key] = parseFloat(val);
        slider.value = val;
        number.value = val;
        if (!rafId) {
          rafId = requestAnimationFrame(() => {
            drawWave();
            rafId = null;
          });
        }
      }

      slider.addEventListener('input', e => update(e.target.value));
      number.addEventListener('input', e => update(e.target.value));
      number.addEventListener('change', e => update(e.target.value));
      number.addEventListener('focus', e => e.stopPropagation());

      label.appendChild(slider);
      label.appendChild(number);
      label.appendChild(document.createTextNode(unit));
      return label;
    }

    // ===== [파형 그리기] =====
    function drawWave() {
      const cvs = document.getElementById('waveform');
      const ctx = cvs.getContext('2d');
      ctx.clearRect(0, 0, cvs.width, cvs.height);
      const w = cvs.width, h = cvs.height;
      ctx.save();
      ctx.strokeStyle = "#2196f3";
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let x = 0; x < w; x++) {
        let t = x / w;
        let y = 0;
        oscillators.forEach(osc => {
          let theta = 2 * Math.PI * osc.freq * t + osc.phase * Math.PI / 180;
          let v = 0;
          switch (osc.type) {
            case "sine": v = Math.sin(theta); break;
            case "triangle": v = 2 * Math.abs(2 * (t * osc.freq - Math.floor(t * osc.freq + 0.5))) - 1; break;
            case "square": v = Math.sign(Math.sin(theta)); break;
            case "sawtooth": v = 2 * (t * osc.freq - Math.floor(t * osc.freq + 0.5)); break;
          }
          y += osc.amp * v;
        });
        if (noiseCancel && oscillators.length > 0) y /= oscillators.length;
        if (x === 0) ctx.moveTo(x, h / 2 - y * h / 4);
        else ctx.lineTo(x, h / 2 - y * h / 4);
      }
      ctx.stroke();
      ctx.restore();
    }

    // ===== [3/5 끝] =====
<!-- ===== [4/5] ===== -->
    // ===== [샘플 파형 버튼 및 샘플 모드 =====
    function setSampleMode(on) {
      isSampleMode = on;
      document.body.className = on ? "show-sample" : "";
      if (on) {
        drawSampleWave();
        renderSampleOscList();
      } else {
        drawWave();
        renderOscList();
      }
    }

    document.getElementById('btn-tri').onclick = function() {
      sampleOscillators = [
        { type: "triangle", freq: 440, amp: 0.7, phase: 0 }
      ];
      setSampleMode(true);
      showSampleFormula('triangle');
    };
    document.getElementById('btn-square').onclick = function() {
      sampleOscillators = [
        { type: "square", freq: 440, amp: 0.7, phase: 0 }
      ];
      setSampleMode(true);
      showSampleFormula('square');
    };
    document.getElementById('btn-saw').onclick = function() {
      sampleOscillators = [
        { type: "sawtooth", freq: 440, amp: 0.7, phase: 0 }
      ];
      setSampleMode(true);
      showSampleFormula('sawtooth');
    };
    document.getElementById('back-btn').onclick = function() {
      setSampleMode(false);
    };

    function showSampleFormula(type) {
      const formulaDiv = document.getElementById('sample-formula');
      let formula = '';
      if (type === 'triangle') {
        formula = '<h3>삼각파</h3>$$x(t) = \\frac{8}{\\pi^2} \\sum_{n=1,3,5,...}^\\infty \\frac{1}{n^2} \\sin(2\\pi n f t)$$';
      } else if (type === 'square') {
        formula = '<h3>사각파</h3>$$x(t) = \\frac{4}{\\pi} \\sum_{n=1,3,5,...}^\\infty \\frac{1}{n} \\sin(2\\pi n f t)$$';
      } else if (type === 'sawtooth') {
        formula = '<h3>톱니파</h3>$$x(t) = \\frac{2}{\\pi} \\sum_{n=1}^\\infty \\frac{(-1)^{n+1}}{n} \\sin(2\\pi n f t)$$';
      }
      formulaDiv.innerHTML = formula;
      if (window.MathJax && window.MathJax.typesetPromise) {
        window.MathJax.typesetPromise([formulaDiv]);
      }
    }

    // ===== [샘플 오실레이터 리스트/슬라이더/입력/삭제] =====
    function renderSampleOscList() {
      const list = document.getElementById('sample-osc-list');
      list.innerHTML = '';
      sampleOscillators.forEach((osc, idx) => {
        const row = document.createElement('div');
        row.className = 'sample-osc-row';

        const typeSel = document.createElement('select');
        WAVE_TYPES.forEach(t => {
          const opt = document.createElement('option');
          opt.value = t.name;
          opt.textContent = t.label;
          if (osc.type === t.name) opt.selected = true;
          typeSel.appendChild(opt);
        });
        typeSel.onchange = function() {
          sampleOscillators[idx].type = this.value;
          drawSampleWave();
        };
        row.appendChild(typeSel);

        row.appendChild(makeSampleSliderInput(osc, idx, 'freq', 20, 2000, 1, 'Hz'));
        row.appendChild(makeSampleSliderInput(osc, idx, 'amp', 0, 1, 0.01, 'A'));
        row.appendChild(makeSampleSliderInput(osc, idx, 'phase', 0, 360, 1, '°'));

        const delBtn = document.createElement('button');
        delBtn.className = 'sample-osc-btn del';
        delBtn.textContent = '삭제';
        delBtn.onclick = function() {
          sampleOscillators.splice(idx, 1);
          renderSampleOscList();
          drawSampleWave();
        };
        row.appendChild(delBtn);

        list.appendChild(row);
      });
    }

    function makeSampleSliderInput(osc, idx, key, min, max, step, unit) {
      const label = document.createElement('label');
      label.textContent = key === 'freq' ? "주파수" : key === 'amp' ? "볼륨" : "위상";

      const slider = document.createElement('input');
      slider.type = 'range';
      slider.min = min;
      slider.max = max;
      slider.step = step;
      slider.value = osc[key];

      const number = document.createElement('input');
      number.type = 'number';
      number.min = min;
      number.max = max;
      number.step = step;
      number.value = osc[key];

      let rafId = null;
      function update(val) {
        osc[key] = parseFloat(val);
        slider.value = val;
        number.value = val;
        if (!rafId) {
          rafId = requestAnimationFrame(() => {
            drawSampleWave();
            rafId = null;
          });
        }
      }

      slider.addEventListener('input', e => update(e.target.value));
      number.addEventListener('input', e => update(e.target.value));
      number.addEventListener('change', e => update(e.target.value));
      number.addEventListener('focus', e => e.stopPropagation());

      label.appendChild(slider);
      label.appendChild(number);
      label.appendChild(document.createTextNode(unit));
      return label;
    }

    // ===== [샘플 파형 그리기] =====
    function drawSampleWave() {
      const cvs = document.getElementById('sample-waveform');
      const ctx = cvs.getContext('2d');
      ctx.clearRect(0, 0, cvs.width, cvs.height);
      const w = cvs.width, h = cvs.height;
      ctx.save();
      ctx.strokeStyle = "#e91e63";
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let x = 0; x < w; x++) {
        let t = x / w;
        let y = 0;
        sampleOscillators.forEach(osc => {
          let theta = 2 * Math.PI * osc.freq * t + osc.phase * Math.PI / 180;
          let v = 0;
          switch (osc.type) {
            case "sine": v = Math.sin(theta); break;
            case "triangle": v = 2 * Math.abs(2 * (t * osc.freq - Math.floor(t * osc.freq + 0.5))) - 1; break;
            case "square": v = Math.sign(Math.sin(theta)); break;
            case "sawtooth": v = 2 * (t * osc.freq - Math.floor(t * osc.freq + 0.5)); break;
          }
          y += osc.amp * v;
        });
        if (sampleNoiseCancel && sampleOscillators.length > 0) y /= sampleOscillators.length;
        if (x === 0) ctx.moveTo(x, h / 2 - y * h / 4);
        else ctx.lineTo(x, h / 2 - y * h / 4);
      }
      ctx.stroke();
      ctx.restore();
    }

    // ===== [샘플 함수 추가/무작위/초기화/노이즈캔슬 버튼] =====
    document.getElementById('sample-add-btn').onclick = function() {
      openOscModal(function(osc) {
        sampleOscillators.push(osc);
        renderSampleOscList();
        drawSampleWave();
      });
    };
    document.getElementById('sample-rand-btn').onclick = function() {
      const type = WAVE_TYPES[Math.floor(Math.random() * WAVE_TYPES.length)].name;
      const freq = Math.floor(Math.random() * 900) + 100;
      const amp = +(Math.random() * 0.8 + 0.2).toFixed(2);
      const phase = Math.floor(Math.random() * 360);
      sampleOscillators.push({ type, freq, amp, phase });
      renderSampleOscList();
      drawSampleWave();
    };
    document.getElementById('sample-reset-btn').onclick = function() {
      sampleOscillators = [];
      renderSampleOscList();
      drawSampleWave();
    };
    document.getElementById('sample-nc-btn').onclick = function() {
      sampleNoiseCancel = !sampleNoiseCancel;
      this.textContent = sampleNoiseCancel ? "노이즈 캔슬링 ON" : "노이즈 캔슬링 OFF";
      drawSampleWave();
    };

    // ===== [4/5 끝] =====
<!-- ===== [5/5] ===== -->
    // ===== [초기화 및 이벤트 바인딩] =====
    function init() {
      resizeCanvas();
      renderOscList();
      drawWave();
      renderSampleOscList();
      drawSampleWave();
    }
    window.addEventListener('DOMContentLoaded', init);
    window.addEventListener('resize', function() {
      resizeCanvas();
      if (isSampleMode) drawSampleWave();
      else drawWave();
    });

    // ===== [오디오 재생(메인/샘플)] =====
    document.getElementById('play-btn').onclick = function() {
      // 오디오 재생 구현 (생략: 실제 오디오 출력 필요시 Web Audio API 활용)
      alert('이 샘플에서는 오디오 출력이 구현되어 있지 않습니다.');
    };
    document.getElementById('restart-btn').onclick = function() {
      // 오디오 재시작 구현 (생략)
      alert('이 샘플에서는 오디오 출력이 구현되어 있지 않습니다.');
    };
    document.getElementById('sample-play-btn').onclick = function() {
      alert('이 샘플에서는 오디오 출력이 구현되어 있지 않습니다.');
    };

    // ===== [모달 닫기(ESC, 바깥 클릭)] =====
    document.getElementById('osc-modal').addEventListener('click', function(e) {
      if (e.target === this) this.style.display = 'none';
    });
    window.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && document.getElementById('osc-modal').style.display === 'flex') {
        document.getElementById('osc-modal').style.display = 'none';
      }
    });
  </script>
</body>
</html>
<!-- ===== [5/5 끝] ===== -->
